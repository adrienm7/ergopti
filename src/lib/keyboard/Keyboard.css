/*
========================================
======= Style général du clavier =======
========================================
*/

keyboard {
	--keyboard-width: 0.9; /* Pourcentage de la longueur de la page */
	--keyboard-margin: calc(
		var(--key-margin) * 7
	); /* Espace entre le bord du clavier et les touches extérieures */

	--key-size: calc(var(--keyboard-width) * 100vw / 15);
	--key-height: calc(var(--key-size) - 2 * var(--key-margin));
	--key-margin: calc(var(--keyboard-width) * 0.4vw);
	--key-depth: 1.5px;
	--key-border-radius: 0.15em;
	--key-shadow: rgba(0, 0, 0, 0.3) 5px 3px 5px;

	--key-pressed-depth: 0.75px;
	--key-depth-change: calc(var(--key-depth) - var(--key-pressed-depth));
	background-color: hsla(216, 100%, 10%, 0.85);
	border: 1px solid hsla(227, 100%, 8%, 0.8);
	border-radius: 7px; /* Arrondi des coins du clavier */
	box-shadow: 0 0 10px 1px rgba(0, 126, 215, 0.8);
	display: block;
	font-weight: 300; /* La graisse est trop "grosse" pour les labels de touches sinon */
	margin: 0 auto;
	padding: var(--keyboard-margin);
	width: max-content;
}

keyboard-row {
	display: flex;
}

.center {
	align-items: center;
	display: flex;
	justify-content: center;
}

keyboard-legend {
	display: block;
	margin: 0;
	margin-top: 7px;
	text-align: center;
}

/*
=========================================
======= Style général des touches =======
=========================================
*/

keyboard-key {
	--longueur-touche: calc(var(--key-size) * var(--size) - 2 * var(--key-margin));
	--effet-3d: hsla(
		var(--key-color),
		var(--key-color-saturation),
		calc(var(--key-color-luminosity) - 20%),
		70%
	);
	--ombres-touche: var(--key-shadow), 0 var(--key-depth) 0 var(--effet-3d);
	--couleur-fond-touche: hsla(
		var(--key-color),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		var(--key-opacity)
	);
	--couleur-bordure-touche: hsla(
		var(--key-color),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		30%
	);
	--size-bordure-touche: 1px; /* calc(var(--keyboard-width) * 0.1rem) */
	--key-text-size: calc(var(--key-size) / 2.5);
	--couleur-texte-touche: hsla(0, 100%, 100%, 90%);
	background-color: var(--couleur-fond-touche);
	border: var(--size-bordure-touche) solid var(--couleur-bordure-touche);
	border-radius: var(--key-border-radius);
	box-shadow: var(--ombres-touche);
	color: var(--couleur-texte-touche);
	display: inline-flex;
	font-size: var(--key-text-size);
	font-weight: 300;
	height: var(--key-height);
	margin: var(--key-margin);
	text-shadow:
		rgb(0, 0, 0) 0px 0 1px,
		rgb(0, 0, 0) 0px 0 6px,
		rgba(0, 0, 0, 0.5) 0px 0 12px;
	width: var(--longueur-touche);
}

kbd,
kbd-sortie,
kbd-non,
keyboard-key {
	align-items: center;
	cursor: pointer;
	font-family: 'Noto Sans', 'Noto Sans Symbols', sans-serif;
	font-optical-sizing: auto;
	font-style: normal;
	font-weight: 300;
	justify-content: center;
	text-align: center;
}

keyboard-key:active,
keyboard-key:hover,
.pressed-key {
	background-color: rgba(255, 255, 255, 0.85) !important;
	box-shadow:
		0 var(--key-pressed-depth) 0 var(--effet-3d),
		inset 0 0 1px #00000077;
	color: #333 !important;
	position: relative;
	text-shadow: none;
	top: var(--key-depth-change);
}

keyboard-key[data-key=''] {
	display: none;
}

keyboard-key[data-key='aucune'],
keyboard-key[data-key='aucune']:hover,
keyboard-key[data-key='aucune'].active {
	background-color: transparent !important;
	border-color: transparent;
	box-shadow: none;
	cursor: auto;
}

keyboard espace-insecable {
	background-color: white;
	border-radius: 1px;
	display: inline-block;
	height: 0.75em;
	margin-right: 2px;
	width: 0.25em;
}

/*
===============================
======= Version Ergodox =======
===============================
*/

/* Separate the keyboard in 2 parts */
keyboard[data-type='ergodox'] keyboard-key[data-column='6'] {
	margin-right: 50px;
}

/* Separate the thumb cluster from the rest of the keyboard */
keyboard[data-type='ergodox'] keyboard-row[data-row='6'] {
	margin-top: 30px;
}

/*
=============================
======= Couche Visuel =======
=============================
*/

keyboard[data-layer='Visuel'] keyboard-key[data-type='lettre'] div,
keyboard[data-layer='Visuel'] keyboard-key[data-type='français'] div {
	text-transform: uppercase;
}

keyboard[data-layer='Visuel'] keyboard-key[data-type='ponctuation'] div {
	font-size: calc(var(--key-text-size) * 0.7);
	font-weight: bolder;
	line-height: 1;
}

/* Cas particulier de la touche Q qui fait Qu */
keyboard[data-layer='Visuel'][data-plus='yes'] keyboard-key[data-key='q'] div,
keyboard[data-layer='Shift'][data-plus='yes'] keyboard-key[data-key='q'] div {
	text-transform: capitalize;
}

/*
===========================
======= Couche Ctrl =======
===========================
*/

keyboard[data-layer='Ctrl'] keyboard-key div {
	text-transform: uppercase;
}

/* Ne pas mettre en uppercase les noms des modificateurs */
keyboard[data-layer='Ctrl'] keyboard-key[data-type='special'] div {
	text-transform: none;
}

/*
===============================
======= Style Ergopti + =======
===============================
*/

/* Style of all keys changing with Ergopti+ */
keyboard[data-plus='yes'] keyboard-key[data-plus='yes']:not([data-key='Space']),
keyboard[data-plus='yes'][data-type='ergodox'][data-layer='Visuel'] keyboard-key[data-key='Space'],
keyboard[data-plus='yes'][data-type='ergodox'][data-layer='Primary']
	keyboard-key[data-key='Space'] {
	--key-color-saturation: 0%;
	--key-color-luminosity: 100%;
	background: linear-gradient(to bottom, rgba(0, 234, 255, 0.15), rgba(102, 0, 255, 0.15));
}

keyboard[data-plus='yes'][data-type='iso'][data-layer='Visuel'] keyboard-key[data-key='Space'] div {
	margin-top: -3px; /* Small fix to adding the "+" that puts the text a bit below its position */
}

/* Tap-holds */
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='Tab'] div,
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='RAlt'] div {
	font-size: calc(var(--key-text-size) * 0.65);
	line-height: 1.1;
}
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='CapsLock'] div,
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='LShift'] div,
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='LCtrl'] div,
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='LAlt'] div {
	font-size: calc(var(--key-text-size) * 0.65);
	line-height: 1.35;
}

tap-hold {
	display: inline-block;
}
output-tap {
	color: rgb(5, 121, 210);
}

keyboard-key[data-key='LShift'] div tap-hold output-hold {
	font-weight: bold;
}

keyboard-key[data-key='RCtrl'] div tap-hold {
	font-size: 0.7em;
	line-height: 1.5;
}

/*
======================================
======= Corrections localisées =======
======================================
*/

/* Different style for dead keys and keys with a different Ctrl layer */
keyboard-key[data-style='morte'],
keyboard-key[data-style='different'] {
	--key-color-saturation: 0% !important;
	--key-color-luminosity: 100% !important;
	--key-opacity: 5% !important;
	font-family: sans-serif; /* Prevent some glyphs on dead keys to be incorrectly displayed */
}

/* Special keys with more than one character on them */
keyboard-key[data-key='Escape'] div,
keyboard-key[data-key='LCtrl'] div,
keyboard-key[data-key='Win'] div,
keyboard-key[data-key='LAlt'] div,
keyboard-key[data-key='RCtrl'] div {
	font-size: calc(var(--key-text-size) * 0.75);
	font-weight: normal;
}
keyboard[data-type='iso'] keyboard-key[data-key='Space'] div,
keyboard[data-type='iso'] keyboard-key[data-key='RAlt'] div,
keyboard[data-type='iso'] keyboard-key[data-key='Option'] div {
	font-size: calc(var(--key-text-size) * 0.7);
	font-weight: normal;
}

keyboard[data-type='ergodox'] keyboard-key[data-key='RAlt'] div {
	font-size: 0.65em;
	font-weight: normal;
}

keyboard-key[data-key='BackSpace'] div,
keyboard-key[data-key='Delete'] div {
	font-size: 0.85em;
}

keyboard-key[data-key='RShift'] div,
keyboard-key[data-key='LShift'] div {
	font-weight: bold; /* Symbol is too thin otherwise */
}

/* Key appearing on the Ergodox layout */
keyboard-key[data-key='AltTab'] div {
	font-size: 0.7em;
	line-height: 1.15;
}

/* Smaller font for keys [qu] and [où] */
keyboard[data-plus='yes'][data-layer='Primary'] keyboard-key[data-key='q'] div,
keyboard[data-plus='yes'][data-layer='AltGr'] keyboard-key[data-key='w'] div {
	font-size: 0.9em;
}
keyboard[data-plus='yes'][data-layer='Visuel'] keyboard-key[data-key='q'] div,
keyboard[data-plus='yes'][data-layer='Shift'] keyboard-key[data-key='q'] div,
keyboard[data-plus='yes'][data-layer='ShiftAltGr'] keyboard-key[data-key='w'] div {
	font-size: 0.85em;
}

/* Smaller font for Win + V */
keyboard[data-layer='Layer'] keyboard-key[data-key='Coller'] div {
	font-size: 0.85em;
}

/* Smaller font in navigation layer to prevent keys with 3 symbols to overflow */
keyboard[data-layer='Layer']
	keyboard-key:not([data-finger='thumb']):not([data-type='special']):not([data-type='enter'])
	div {
	font-size: 0.8em;
}

keyboard[data-layer='Layer'][data-type='ergodox'] keyboard-key[data-key='Space'] div {
	font-size: 0.65em;
}

/* Smaller CapsLock symbol */
keyboard[data-plus='no'] keyboard-key[data-key='CapsLock'] div {
	font-size: calc(var(--key-text-size) * 0.85);
}

/* Smaller font in , layer to prevent keys with 2 symbols to overflow */
keyboard[data-layer=','] keyboard-key:not([data-type='special']):not([data-type='enter']) div {
	font-size: 0.9em;
}

/* Smaller font in À layer to prevent keys with 4 symbols to overflow */
keyboard[data-layer='À'] keyboard-key:not([data-type='special']):not([data-type='enter']) div {
	font-size: 0.7em;
}

/*
=========================
======= Enter key =======
=========================
*/

keyboard[data-type='iso'] keyboard-key[data-type='enter'] {
	border-right: none;
	position: relative;
	top: 0;
	z-index: 1;
}

keyboard[data-type='iso'] keyboard-key[data-type='enter'] div {
	font-weight: normal;
	z-index: 3;
}

/* On cache la jonction entre la touche et le bas de la touche créé par ::after, avec un rectangle par-dessus */
keyboard[data-type='iso'] keyboard-key[data-type='enter']::before {
	background-color: var(--couleur-fond-touche);
	border-radius: 0 calc(var(--key-border-radius) - 1px) 0 0;
	border-right: var(--size-bordure-touche) solid var(--couleur-bordure-touche);
	content: '';
	height: var(--key-size);
	position: absolute;
	right: 0;
	top: 0;
	width: calc(var(--key-size) - 2 * var(--key-margin) - 1px);
	z-index: 2;
}

/* On crée la partie en bas de la touche Entrée */
keyboard[data-type='iso'] keyboard-key[data-type='enter']::after {
	background-color: var(--couleur-fond-touche);
	border: var(--size-bordure-touche) solid var(--couleur-bordure-touche);
	border-radius: 0 0 var(--key-border-radius) var(--key-border-radius);
	border-top: none;
	box-shadow:
		var(--key-shadow),
		0 var(--key-depth) 0 var(--effet-3d),
		-0.5px var(--key-depth) 0 var(--effet-3d);
	content: '';
	height: calc(var(--key-size) + var(--key-margin) / 2);
	position: absolute;
	right: 0;
	top: 100%;
	width: calc(var(--key-size) - 2 * var(--key-margin));
	z-index: 0;
}

/* Ce qui se passe quand on presse la touche Entrée */

keyboard[data-type='iso'] keyboard-key[data-type='enter']:active,
keyboard[data-type='iso'] keyboard-key[data-type='enter']:hover {
	position: relative;
	top: var(--key-depth-change);
}

keyboard[data-type='iso'] keyboard-key[data-type='enter']:active::before,
keyboard[data-type='iso'] keyboard-key[data-type='enter']:hover::before {
	height: var(--key-size);
}

keyboard[data-type='iso'] keyboard-key[data-type='enter']:active::after,
keyboard[data-type='iso'] keyboard-key[data-type='enter']:hover::after {
	box-shadow:
		0 var(--key-pressed-depth) 0 var(--effet-3d),
		0 var(--key-pressed-depth) 0 var(--effet-3d);
}

/* Couleur de la touche Entrée */

keyboard-key[data-type='enter']::before,
keyboard-key[data-type='enter']::after {
	background-color: rgb(10, 10, 10) !important;
	color: white !important;
}

keyboard-key[data-type='enter']:hover,
keyboard-key[data-type='enter']:hover::before,
keyboard-key[data-type='enter']:hover::after,
keyboard-key[data-type='enter'].pressed-key,
keyboard-key[data-type='enter'].pressed-key::before,
keyboard-key[data-type='enter'].pressed-key::after {
	background-color: rgb(210, 210, 210) !important;
	box-shadow: none;
	color: #333;
}

/*
======================
======= Colors =======
======================
*/

/* Couleur des touches par doigt et hand */
/* On ne les sépare pas de pile 45 degrés, c’est adapté pour un meilleur rendu */
keyboard {
	--color-left-index-finger: 0deg;
	--color-left-middle-finger: 35deg; /* 45deg in theory to divide regularly */
	--color-left-ring-finger: 60deg; /* 90deg in theory to divide regularly */
	--color-left-little-finger: 115deg; /* 135deg in theory to divide regularly */
	--color-right-little-finger: 180deg;
	--color-right-ring-finger: 225deg;
	--color-right-middle-finger: 270deg;
	--color-right-index-finger: 315deg;
}

keyboard-key[data-hand='left'][data-finger='index'] {
	--key-color: var(--color-left-index-finger);
}

keyboard-key[data-hand='left'][data-finger='majeur'] {
	--key-color: var(--color-left-middle-finger);
}

keyboard-key[data-hand='left'][data-finger='annulaire'] {
	--key-color: var(--color-left-ring-finger);
}

keyboard-key[data-hand='left'][data-finger='auriculaire'] {
	--key-color: var(--color-left-little-finger);
}

keyboard-key[data-hand='right'][data-finger='index'] {
	--key-color: var(--color-right-index-finger);
}

keyboard-key[data-hand='right'][data-finger='majeur'] {
	--key-color: var(--color-right-middle-finger);
}

keyboard-key[data-hand='right'][data-finger='annulaire'] {
	--key-color: var(--color-right-ring-finger);
}

keyboard-key[data-hand='right'][data-finger='auriculaire'] {
	--key-color: var(--color-right-little-finger);
}

/* Specific color for the Space bar */
/* keyboard[data-type='iso'] keyboard-key[data-type='space'] {
	background-color: rgb(0, 10, 30);
} */

/* Specific color for Ergodox thumb keys */
keyboard[data-type='ergodox'] keyboard-key[data-finger='thumb'] {
	background-color: rgba(140, 160, 170, 0.25);
}

/* === Couleur des touches spéciales === */

keyboard-key[data-type='space'],
keyboard-key[data-type='special'],
keyboard-key[data-key='Enter'] {
	background-color: rgb(10, 10, 10);
	color: white;
	/* Bordure des touches des touches spéciales en blanc pour mieux les mettre en relief */
	--couleur-bordure-touche: hsla(var(--key-color), 100%, 100%, 35%);
	--effet-3d: hsla(var(--key-color), 0%, calc(100% - 20%), 70%);
	/* Bordure de la version Ergodox */
	--key-color: 0deg !important;
	--key-color-saturation: 0% !important;
}

/* === Si couleur, ou couleur spéciale === */

keyboard keyboard-key {
	--key-color-luminosity: 70%;
	--key-color-saturation: 100%;
	--key-opacity: 30%;
}

keyboard[data-couleur='no'] keyboard-key {
	--key-color: 190 !important;
	--key-color-luminosity: 70%;
	--key-opacity: 20%;
}

keyboard[data-couleur='azerty'] keyboard-key {
	--key-color: 200 !important;
}
keyboard[data-couleur='azerty'] keyboard-legend {
	color: hsl(200, 100%, 80%);
}

keyboard[data-couleur='ergopti'] keyboard-key {
	--key-color: 300 !important;
}
keyboard[data-couleur='ergopti'] keyboard-legend {
	color: hsl(300, 100%, 85%);
}

keyboard[data-couleur='freq'] keyboard-key {
	--key-color-luminosity: 100%;
	--key-color-saturation: 0%;
}

keyboard[data-couleur='freq'] keyboard-key[data-type='lettre'],
keyboard[data-couleur='freq'] keyboard-key[data-type='français'],
keyboard[data-couleur='freq'] keyboard-key[data-type='ponctuation'] {
	--key-color: calc(180deg * (1 - var(--frequency_normalized)));
	--key-color-saturation: 90%;
	--key-color-luminosity: 70%;
	--key-opacity: 45%;
	background-color: hsla(
		var(--key-color),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		var(--key-opacity)
	);
}

/*
==================================================
======= Style par emplacements de claviers =======
==================================================
*/

#clavier_reference {
	--keyboard-width: 0.6;
}

#clavier_presentation,
#clavier_presentation_plus {
	--keyboard-width: 0.5;
}

@media (max-width: 700px) {
	#clavier_reference,
	#clavier_presentation,
	#clavier_presentation_plus {
		--keyboard-width: 0.9;
	}
}

keyboard,
#clavier_emulation {
	--key-size: min(47px, 100vw / 20) !important;
	--key-margin: min(3px, 0.35vw) !important;
	--key-depth: 1px !important;
	--key-pressed-depth: 0.5px !important;
}

#clavier_controle keyboard-key[data-column]:nth-child(n + 8):nth-child(-n + 17),
#clavier_controle keyboard-key[data-column='0'],
#clavier_raccourcis_ergodox keyboard-key[data-column]:nth-child(n + 8):nth-child(-n + 17) {
	display: none;
}
#clavier_controle keyboard-key[data-column='6'],
#clavier_raccourcis_ergodox keyboard-key[data-column='6'] {
	margin-right: 0;
}

#clavier_symboles_plus keyboard-row:nth-child(n + 5) {
	display: none;
}

#clavier_magique keyboard-key[data-plus='yes']:not([data-key='magique']) {
	background: unset !important;
	--key-color-saturation: 100% !important;
	--key-color-luminosity: 70% !important;
	background-color: var(--couleur-fond-touche) !important;
}
#clavier_magique keyboard-key[data-plus='yes']:not([data-key='magique']):hover {
	background-color: rgba(255, 255, 255, 0.85) !important;
}
#clavier_magique keyboard-key[data-plus='yes'][data-type='special'] {
	background-color: rgb(10, 10, 10) !important;
}
#clavier_magique keyboard-key[data-key='magique'] {
	background: linear-gradient(to bottom, rgba(255, 0, 0, 0.15), rgba(255, 0, 0, 0.15));
}
