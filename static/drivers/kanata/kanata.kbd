;; === Configuration ===
(defcfg
  process-unmapped-keys yes
)

;; === Physical key source ===
(defsrc
    `           1           2           3           4           5                       6           7           8           9           0
    tab         q           w           e           r           t                       y           u           i           o           p           [
    caps        a           s           d           f           g                       h           j           k           l           ;           '
    lsft        <           z           x           c           v           b           n           m           ,           .           /
    lctl                                lmet        lalt                   spc                      ralt        rctl                    rsft
)

;; === Default layer ===
(deflayer default
    _           _           _           _           _           _                       _           _           _           _           _
    @alttab     _           _           _           _           _                       _           _           _           _           _           _
    @cap        _           _           _           _           _                       _           _           _           _           _           _
    @lsft       _           _           _           _           _            _          _           _           _           _           _
    @lctl                               _           @lalt                    _                      @ralt       @ossft                  _
)

;; === Navigation layer ===
(deflayer navigation
    _           _           _           _           _           _                       _           _           _           _           _
    _           S-C-home    C-home      C-end       S-C-end     f12                     S-home      S-C-left    S-left      S-right     S-C-right   S-end
    _           C-up        up          down        C-down      f2                      M-S-left    C-left      left        right       C-right     M-S-right
    _           S-A-up      A-up        A-down      S-A-down    _            _          M-up        home        M-left      M-right     end
    _                                   _           _                        _                      _           _                       _
)

;; ==================================
;; === Ergopti ➜ QWERTY mappings ===
;; ==================================

(defalias
  ;; === Numbers and symbols ===
  $ `
  1 1
  2 2
  3 3
  4 4
  5 5
  6 6
  7 7
  8 8
  9 9
  0 0
  % -
  = =

  ;; === Top row ===
  è q
  y w
  o e
  w r
  b t
  f y
  g u
  h i
  c o
  x p
  z [
  deadtrema ]

  ;; === Middle row ===
  a a
  i s
  e d
  u f
  : g
  . AG-g
  v h
  s j
  n k
  t l
  r ;
  q '
  deadcirc \

  ;; === Bottom row ===
  é z
  à x
  j c
  , v
  ; AG-v
  k b
  m n
  d m
  l ,
  p .
  ' /
)

;; ===============================
;; === Functions and shortcuts ===
;; ===============================

(defalias
    copy (multi lctl @c)
    paste (multi lctl @v)
    alttab (tap-hold-press 200 200 (multi lalt tab) lalt)
    cap (tap-hold-press 200 200 enter lctl)
    lsft (tap-hold-press 200 200 @copy lsft)
    lctl (tap-hold-press 200 200 @paste lctl)
    lalt (tap-hold-press 200 200 bspc (layer-toggle navigation))
    ralt (tap-hold-press 200 200 
        (multi (release-key lctl) (release-key lalt) tab)
        (multi ralt (release-key lctl))
    )
    ossft (one-shot 1000 lsft)
)
