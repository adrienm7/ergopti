/*
=============================================
======= General style of the keyboard =======
=============================================
*/

keyboard {
	--keyboard-percentage: 0.9;
	--keyboard-width: calc(var(--main-width) * var(--keyboard-percentage));
	--keyboard-padding: clamp(7px, calc(var(--keyboard-width) / 50), 50px);
	--keyboard-border-radius: var(--keyboard-padding);
	background-color: hsla(208, 100%, 10%, 0.7);
	border: 1px solid hsla(225, 100%, 8%, 0.8);
	border-radius: var(--keyboard-border-radius);
	box-shadow: rgba(255, 255, 255, 0.8) 0px 1px 4px;
	display: block;
	margin: 0 auto; /* Center horizontally */
	padding: var(--keyboard-padding);
	width: max-content;
}

keyboard-row {
	display: flex;
}

/* To center a keyboard row when we want to only show one row out of the entire keyboard */
.center {
	align-items: center;
	display: flex;
	justify-content: center;
}

keyboard-legend {
	display: block;
	margin: 0;
	margin-top: 7px;
	text-align: center;
}

/*
==============================
======= Ergodox layout =======
==============================
*/

/* Separate the keyboard in 2 parts */
keyboard[data-type='ergodox'] keyboard-key[data-column='6'] {
	margin-right: 50px;
}

/* Separate the thumb cluster from the rest of the keyboard */
keyboard[data-type='ergodox'] keyboard-row[data-row='6'] {
	margin-top: 30px;
}

/*
=========================================
======= General style of the keys =======
=========================================
*/

kbd,
kbd-output,
kbd-non,
keyboard-key {
	align-content: center;
	align-items: center;
	cursor: pointer;
	display: inline-block;
	font-family: 'Noto Sans', 'Noto Sans Symbols', sans-serif;
	font-optical-sizing: auto;
	font-style: normal;
	font-weight: 300;
	justify-content: center;
	text-align: center;
}

p kbd,
p kbd-output {
	line-height: 1.2em;
}

keyboard-key {
	--key-size: calc(var(--keyboard-width) / 16);
	--key-margin: calc(0.05 * var(--key-size));

	--key-depth: calc(var(--key-size) * 0.06);
	--key-pressed-depth: 1px;
	--key-pressed-depth-change: calc(var(--key-depth) - var(--key-pressed-depth));

	--key-shadow: rgba(0, 0, 0, 0.3) 5px 3px 5px;
	--effect-3d: hsla(
		var(--key-color-hue),
		var(--key-color-saturation),
		calc(var(--key-color-luminosity) - 20%),
		70%
	);
	--key-border-color: hsla(
		var(--key-color-hue),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		30%
	);
	--key-border-radius: calc(var(--keyboard-border-radius) / 5);
	--key-border-size: 1px;
	--key-text-size: calc(var(--key-size) / 2.5);

	background-color: hsla(
		var(--key-color-hue),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		var(--key-opacity)
	);
	border: var(--key-border-size) solid var(--key-border-color);
	border-radius: var(--key-border-radius);
	box-shadow:
		var(--key-shadow),
		0 var(--key-depth) 0 var(--effect-3d);
	color: white;
	font-size: var(--key-text-size);
	height: calc(var(--key-size) - 2 * var(--key-margin));
	margin: var(--key-margin);
	text-shadow:
		rgb(0, 0, 0) 0px 0 1px,
		rgb(0, 0, 0) 0px 0 6px,
		rgba(0, 0, 0, 0.5) 0px 0 12px;
	width: calc(var(--key-size) * var(--size) - 2 * var(--key-margin));
}

@media (max-width: 500px) {
	keyboard-key {
		--key-depth: 1px;
		--key-pressed-depth: 0.5px;
		--key-border-radius: calc(var(--keyboard-border-radius) / 8);
	}
}

keyboard-key:active,
keyboard-key:hover,
.pressed-key {
	background-color: rgba(255, 255, 255, 0.85) !important;
	box-shadow:
		0 var(--key-pressed-depth) 0 var(--effect-3d),
		inset 0 0 1px #00000077;
	color: #333 !important;
	/* filter: brightness(200%);
	border-width: 3px; */
	font-weight: 400;
	position: relative;
	text-shadow: none;
	top: var(--key-pressed-depth-change);
}

/* Keys we want to completely disappear */
keyboard-key[data-key=''] {
	display: none;
}

/* Keys we want to be invisible, but still occupy the space */
keyboard-key[data-key='none'] {
	background-color: transparent !important;
	border-color: transparent;
	box-shadow: none;
	cursor: auto;
}

/*
======================
======= Colors =======
======================
*/

/* Key colors by finger and hand */
/* They are not split at an exact 45-degree angle, as this provides a better visual rendering */
keyboard {
	--color-left-index-finger: 0deg;
	--color-left-middle-finger: 35deg; /* 45deg in theory to divide regularly */
	--color-left-ring-finger: 60deg; /* 90deg in theory to divide regularly */
	--color-left-little-finger: 115deg; /* 135deg in theory to divide regularly */
	--color-right-little-finger: 180deg;
	--color-right-ring-finger: 225deg;
	--color-right-middle-finger: 270deg;
	--color-right-index-finger: 315deg;
}

keyboard-key[data-hand='left'][data-finger='index'] {
	--key-color-hue: var(--color-left-index-finger);
}

keyboard-key[data-hand='left'][data-finger='majeur'] {
	--key-color-hue: var(--color-left-middle-finger);
}

keyboard-key[data-hand='left'][data-finger='annulaire'] {
	--key-color-hue: var(--color-left-ring-finger);
}

keyboard-key[data-hand='left'][data-finger='auriculaire'] {
	--key-color-hue: var(--color-left-little-finger);
}

keyboard-key[data-hand='right'][data-finger='index'] {
	--key-color-hue: var(--color-right-index-finger);
}

keyboard-key[data-hand='right'][data-finger='majeur'] {
	--key-color-hue: var(--color-right-middle-finger);
}

keyboard-key[data-hand='right'][data-finger='annulaire'] {
	--key-color-hue: var(--color-right-ring-finger);
}

keyboard-key[data-hand='right'][data-finger='auriculaire'] {
	--key-color-hue: var(--color-right-little-finger);
}

/* === Color configurations === */

keyboard-key {
	--key-color-luminosity: 70%;
	--key-color-saturation: 100%;
	--key-opacity: 30%;
}

keyboard[data-color='no'] keyboard-key {
	--key-color-hue: 190 !important;
	--key-color-luminosity: 70%;
	--key-opacity: 20%;
}

keyboard[data-color='azerty'] keyboard-key {
	--key-color-hue: 200 !important;
}
keyboard[data-color='azerty'] keyboard-legend {
	color: hsl(200, 100%, 80%);
}

keyboard[data-color='ergopti'] keyboard-key {
	--key-color-hue: 300 !important;
}
keyboard[data-color='ergopti'] keyboard-legend {
	color: hsl(300, 100%, 85%);
}

keyboard[data-color='freq'] keyboard-key {
	--key-color-luminosity: 100%;
	--key-color-saturation: 0%;
}

keyboard[data-color='freq'] keyboard-key[data-type='letter'],
keyboard[data-color='freq'] keyboard-key[data-type='french'],
keyboard[data-color='freq'] keyboard-key[data-type='ponctuation'] {
	--key-color-hue: calc(180deg * (1 - var(--frequency_normalized)));
	--key-color-saturation: 90%;
	--key-color-luminosity: 70%;
	--key-opacity: 45%;
	background-color: hsla(
		var(--key-color-hue),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		var(--key-opacity)
	);
}

/* === Specific keys color === */

keyboard-key[data-key='Space'],
keyboard-key[data-type='special'],
keyboard-key[data-key='Enter'] {
	background-color: rgb(10, 10, 10);
	color: white;
	/* Borders of special keys in white to enhance their emphasis */
	--key-border-color: hsla(var(--key-color-hue), 100%, 100%, 35%);
	--effect-3d: hsla(var(--key-color-hue), 0%, calc(100% - 20%), 70%);
	--key-color-hue: 0deg !important;
	--key-color-saturation: 0% !important;
}

/* Specific color of the Space bar */
/* keyboard[data-type='iso'] keyboard-key[data-type='space'] {
	background-color: rgb(0, 10, 30);
} */

/* Specific color of the Ergodox thumb keys */
keyboard[data-type='ergodox'] keyboard-key[data-finger='thumb'] {
	background-color: rgba(140, 160, 170, 0.25);
}

/*
==============================
======= Ergopti+ style =======
==============================
*/

/* Style of all keys changing with Ergopti+ */
keyboard[data-plus='yes'] keyboard-key[data-plus='yes']:not([data-key='Space']),
keyboard[data-plus='yes'][data-type='ergodox'][data-layer='Visuel'] keyboard-key[data-key='Space'],
keyboard[data-plus='yes'][data-type='ergodox'][data-layer='Primary']
	keyboard-key[data-key='Space'] {
	--key-color-saturation: 0%;
	--key-color-luminosity: 100%;
	background: linear-gradient(to bottom, rgba(0, 234, 255, 0.15), rgba(102, 0, 255, 0.15));
}

keyboard[data-plus='yes'][data-type='iso'][data-layer='Visuel'] keyboard-key[data-key='Space'] {
	/* margin-top: -3px; Small fix because adding the "+" puts the text a bit below its position */
}

/* === Tap-holds === */

tap-hold {
	display: inline-block;
	font-size: calc(var(--key-text-size) * 0.65);
	font-weight: 400;
}

output-tap {
	color: rgb(0, 128, 226);
}

keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='Tab'] tap-hold,
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='RAlt'] tap-hold {
	line-height: 1.1;
}

keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='CapsLock'] tap-hold {
	font-size: calc(var(--key-text-size) * 0.65);
	line-height: 1.25;
}

keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='LCtrl'] tap-hold,
keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='LAlt'] tap-hold {
	line-height: 1.35;
}

keyboard[data-plus='yes'][data-type='iso'] keyboard-key[data-key='RCtrl'] tap-hold {
	font-size: 0.7em;
	line-height: 1.5;
}

/* Shift symbol in bold and bigger */
keyboard-key[data-key='LShift'] tap-hold output-hold {
	font-size: 1.3em;
	font-weight: bold;
	line-height: 1.15;
}

/*
=============================
======= Layer: Visuel =======
=============================
*/

keyboard[data-layer='Visuel'] keyboard-key[data-type='letter'],
keyboard[data-layer='Visuel'] keyboard-key[data-type='french'] {
	text-transform: uppercase;
}

keyboard[data-layer='Visuel'] keyboard-key[data-type='ponctuation'] {
	font-size: calc(var(--key-text-size) * 0.7);
	font-weight: 500;
	line-height: 1;
}

/* Special case of the key Q that gives Qu */
keyboard[data-layer='Visuel'][data-plus='yes'] keyboard-key[data-key='q'],
keyboard[data-layer='Shift'][data-plus='yes'] keyboard-key[data-key='q'] {
	text-transform: capitalize;
}

/*
===========================
======= Layer: Ctrl =======
===========================
*/

/* Uppercase all keys, except the modifier names */
keyboard[data-layer='Ctrl'] keyboard-key:not([data-type='special']) {
	text-transform: uppercase;
}

/*
=========================
======= Enter key =======
=========================
*/

keyboard[data-type='iso'] keyboard-key[data-type='enter'] {
	border-right: none;
	position: relative;
	top: 0;
	z-index: 1;
}

keyboard[data-type='iso'] keyboard-key[data-type='enter'] div {
	font-weight: normal;
	position: relative;
	z-index: 3;
}

/* Hide the junction between the key and the bottom of the key created by ::after, using a rectangle on top */
keyboard[data-type='iso'] keyboard-key[data-type='enter']::before {
	border-radius: 0 calc(var(--key-border-radius) - 1px) 0 0;
	border-right: var(--key-border-size) solid var(--key-border-color);
	content: '';
	height: var(--key-size);
	position: absolute;
	right: 0;
	top: 0;
	width: calc(var(--key-size) - 2 * var(--key-margin) - 1px);
	z-index: 2;
}

/* Create the bottom part of the Enter key */
keyboard[data-type='iso'] keyboard-key[data-type='enter']::after {
	border: var(--key-border-size) solid var(--key-border-color);
	border-radius: 0 0 var(--key-border-radius) var(--key-border-radius);
	border-top: none;
	box-shadow:
		var(--key-shadow),
		0 var(--key-depth) 0 var(--effect-3d),
		-0.5px var(--key-depth) 0 var(--effect-3d);
	content: '';
	height: calc(var(--key-size) + var(--key-margin) / 2);
	position: absolute;
	right: 0;
	top: 100%;
	width: calc(var(--key-size) - 2 * var(--key-margin));
	z-index: 0;
}

/* === What happens when the Enter key is pressed === */

keyboard[data-type='iso'] keyboard-key[data-type='enter']:active,
keyboard[data-type='iso'] keyboard-key[data-type='enter']:hover {
	position: relative;
	top: var(--key-pressed-depth-change);
}

keyboard[data-type='iso'] keyboard-key[data-type='enter']:active::before,
keyboard[data-type='iso'] keyboard-key[data-type='enter']:hover::before {
	height: var(--key-size);
}

keyboard[data-type='iso'] keyboard-key[data-type='enter']:active::after,
keyboard[data-type='iso'] keyboard-key[data-type='enter']:hover::after {
	box-shadow:
		0 var(--key-pressed-depth) 0 var(--effect-3d),
		0 var(--key-pressed-depth) 0 var(--effect-3d);
}

/* === Enter key color === */

keyboard-key[data-type='enter']::before,
keyboard-key[data-type='enter']::after {
	background-color: rgb(10, 10, 10) !important;
	color: white !important;
}

keyboard-key[data-type='enter']:hover,
keyboard-key[data-type='enter']:hover::before,
keyboard-key[data-type='enter']:hover::after,
keyboard-key[data-type='enter'].pressed-key,
keyboard-key[data-type='enter'].pressed-key::before,
keyboard-key[data-type='enter'].pressed-key::after {
	background-color: rgb(210, 210, 210) !important;
	box-shadow: none;
	color: #333;
}

/*
=====================================
======= Localized corrections =======
=====================================
*/

/* Different style for dead keys and keys with a different Ctrl layer */
keyboard-key[data-style='morte'],
keyboard-key[data-style='different'] {
	--key-color-saturation: 0% !important;
	--key-color-luminosity: 100% !important;
	--key-opacity: 5% !important;
	font-weight: 400;
}
keyboard-key[data-content='◌̈'],
keyboard-key[data-content='◌̂'] {
	font-family: 'Open Sans'; /* Prevent some glyphs on dead keys to be incorrectly displayed */
}

/* J key seems lower than the others otherwise */
keyboard-key[data-key='j'][data-content='j'] div,
keyboard-key[data-key='j'][data-content='J'] div {
	position: relative;
	right: -0.05em;
	top: -0.1em;
}
/* ★ key seems lower than the others otherwise */
keyboard-key[data-content='★'] div {
	position: relative;
	top: -0.05em;
}

/* Special keys with more than one character on them */
keyboard-key[data-key='Escape'],
keyboard-key[data-key='LCtrl'],
keyboard-key[data-key='Win'],
keyboard-key[data-key='LAlt'],
keyboard-key[data-key='RCtrl'] {
	font-size: calc(var(--key-text-size) * 0.75);
	font-weight: normal;
}
keyboard[data-type='iso'] keyboard-key[data-key='Space'],
keyboard[data-type='iso'] keyboard-key[data-key='RAlt'],
keyboard[data-type='iso'] keyboard-key[data-key='Option'] {
	font-size: calc(var(--key-text-size) * 0.7);
	font-weight: normal;
}

keyboard[data-type='ergodox'] keyboard-key[data-key='RAlt'] {
	font-size: calc(var(--key-text-size) * 0.65);
	font-weight: normal;
}

keyboard-key[data-key='BackSpace'],
keyboard-key[data-key='Delete'] {
	font-size: calc(var(--key-text-size) * 0.85);
}

keyboard-key[data-key='RShift'],
keyboard-key[data-key='LShift'] {
	font-weight: bold; /* Symbol is too thin otherwise */
}

/* Key appearing on the Ergodox layout */
keyboard-key[data-key='AltTab'] {
	font-size: calc(var(--key-text-size) * 0.7);
	line-height: 1.15;
}

/* Smaller font for keys [qu] and [où] */
keyboard[data-plus='yes'][data-layer='Primary'] keyboard-key[data-key='q'],
keyboard[data-plus='yes'][data-layer='AltGr'] keyboard-key[data-key='w'] {
	font-size: calc(var(--key-text-size) * 0.9);
}
keyboard[data-plus='yes'][data-layer='Visuel'] keyboard-key[data-key='q'],
keyboard[data-plus='yes'][data-layer='Shift'] keyboard-key[data-key='q'],
keyboard[data-plus='yes'][data-layer='ShiftAltGr'] keyboard-key[data-key='w'] {
	font-size: calc(var(--key-text-size) * 0.85);
}

/* Smaller font for Win + V */
keyboard[data-layer='Layer'] keyboard-key[data-key='Coller'] {
	font-size: calc(var(--key-text-size) * 0.85);
}

/* Smaller font in , layer to prevent keys with 2 symbols to overflow */
keyboard[data-layer=','] keyboard-key:not([data-type='special']):not([data-type='enter']) {
	font-size: calc(var(--key-text-size) * 0.9);
}

/* Smaller font in À layer to prevent keys with 4 symbols to overflow */
keyboard[data-layer='À'] keyboard-key:not([data-type='special']):not([data-type='enter']) {
	font-size: calc(var(--key-text-size) * 0.7);
}

/* Smaller font in navigation layer to prevent keys with 3 symbols to overflow */
keyboard[data-layer='Layer']
	keyboard-key:not([data-finger='thumb']):not([data-type='special']):not([data-type='enter']) {
	font-size: calc(var(--key-text-size) * 0.8);
}

/* Label "Layer" overflows otherwise */
keyboard[data-layer='Layer'][data-type='ergodox'] keyboard-key[data-key='Space'] {
	font-size: calc(var(--key-text-size) * 0.65);
}

/* Smaller CapsLock symbol */
keyboard-key[data-key='CapsLock'] tap-hold,
keyboard-key[data-key='CapsLock'][data-content='⌫'],
keyboard-key[data-key='CapsLock'][data-content='⌦'] {
	font-size: calc(var(--key-text-size) * 0.85);
}
keyboard-key[data-key='CapsLock'][data-content='Ctrl + ⌫'],
keyboard-key[data-key='CapsLock'][data-content='Ctrl + ⌦'] {
	font-size: calc(var(--key-text-size) * 0.7);
}

keyboard-key[data-content='Caps<br>word'] {
	font-size: calc(var(--key-text-size) * 0.65);
}

/* Change font to avoid an ugly % glyph */
keyboard-key[data-content='%'],
keyboard-key[data-content='<nbsp></nbsp>%'] {
	font-family:
		system-ui,
		-apple-system,
		BlinkMacSystemFont,
		'Segoe UI',
		'Helvetica Neue',
		'Open Sans';
}

/*
===========================================
======= Styles by keyboard location =======
===========================================
*/

/* === 3 main keyboards === */

#keyboard_reference {
	--keyboard-width: 50vw;
}

#keyboard_presentation,
#keyboard_presentation_plus,
#keyboard_emulation {
	--keyboard-width: calc(40vw + 25vh);
}

@media (max-width: 900px) {
	#keyboard_reference,
	#keyboard_presentation,
	#keyboard_presentation_plus,
	#keyboard_presentation_emulation {
		--keyboard-width: 90vw;
	}
}

/* === keyboard_controle and keyboard_raccourcis_ergodox === */

#keyboard_controle keyboard-key[data-column]:nth-child(n + 8):nth-child(-n + 17),
#keyboard_controle keyboard-key[data-column='0'],
#keyboard_raccourcis_ergodox keyboard-key[data-column]:nth-child(n + 8):nth-child(-n + 17) {
	display: none;
}

#keyboard_controle keyboard-key[data-column='6'],
#keyboard_raccourcis_ergodox keyboard-key[data-column='6'] {
	margin-right: 0;
}

/* === keyboard_symboles_plus === */

#keyboard_symboles_plus keyboard-row:nth-child(n + 5) {
	display: none;
}

/* === keyboard_magique === */

#keyboard_magique keyboard-key[data-plus='yes']:not([data-key='magique']) {
	background: unset !important;
	--key-color-saturation: 100% !important;
	--key-color-luminosity: 70% !important;
	background-color: hsla(
		var(--key-color-hue),
		var(--key-color-saturation),
		var(--key-color-luminosity),
		var(--key-opacity)
	) !important;
}

#keyboard_magique keyboard-key[data-plus='yes']:not([data-key='magique']):hover {
	background-color: rgba(255, 255, 255, 0.85) !important;
}

#keyboard_magique keyboard-key[data-plus='yes'][data-type='special'] {
	background-color: rgb(10, 10, 10) !important;
}

#keyboard_magique keyboard-key[data-key='magique'] {
	background: linear-gradient(to bottom, rgba(255, 0, 0, 0.15), rgba(255, 0, 0, 0.15));
}

/*
==========================================
======= HTML code used in the keys =======
==========================================
*/

nbsp {
	background-color: white;
	border-radius: 1px;
	display: inline-block;
	height: 0.75em;
	margin-right: 2px;
	width: 0.25em;
}
